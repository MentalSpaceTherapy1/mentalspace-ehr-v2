{
  "family": "verify-migration",
  "cpu": "256",
  "memory": "512",
  "networkMode": "awsvpc",
  "requiresCompatibilities": ["FARGATE"],
  "executionRoleArn": "arn:aws:iam::706704660887:role/ecsTaskExecutionRole",
  "taskRoleArn": "arn:aws:iam::706704660887:role/ecsTaskExecutionRole",
  "containerDefinitions": [{
    "name": "verify",
    "image": "706704660887.dkr.ecr.us-east-1.amazonaws.com/mentalspace-backend:c3a7950",
    "essential": true,
    "entryPoint": ["node"],
    "command": [
      "-e",
      "const {Client} = require('pg'); const c = new Client({connectionString: process.env.DATABASE_URL, ssl: {rejectUnauthorized: false}}); (async () => {await c.connect(); console.log('Connected to database'); const r = await c.query(`SELECT column_name, is_nullable, data_type FROM information_schema.columns WHERE table_name = 'clinical_notes' AND column_name IN ('appointmentId', 'sessionDate', 'dueDate') ORDER BY column_name`); console.log('\\nColumn verification:'); r.rows.forEach(row => console.log(`${row.column_name}: nullable=${row.is_nullable}, type=${row.data_type}`)); const allNullable = r.rows.every(row => row.is_nullable === 'YES'); console.log('\\nAll columns nullable:', allNullable ? 'YES' : 'NO'); const tables = await c.query(`SELECT tablename FROM pg_tables WHERE schemaname = 'public' AND tablename LIKE '%migration%' ORDER BY tablename`); console.log('\\nMigration tables found:'); tables.rows.forEach(row => console.log(`- ${row.tablename}`)); await c.end(); console.log('\\nVerification complete'); process.exit(allNullable ? 0 : 1)})().catch(e => {console.error('ERROR:', e.message); process.exit(1)})"
    ],
    "environment": [{
      "name": "DATABASE_URL",
      "value": "postgresql://mentalspace_admin:MentalSpace2024!SecurePwd@mentalspace-ehr-prod.ci16iwey2cac.us-east-1.rds.amazonaws.com:5432/mentalspace_ehr"
    }],
    "logConfiguration": {
      "logDriver": "awslogs",
      "options": {
        "awslogs-group": "/ecs/mentalspace-migration",
        "awslogs-region": "us-east-1",
        "awslogs-stream-prefix": "verify",
        "awslogs-create-group": "true"
      }
    }
  }]
}
