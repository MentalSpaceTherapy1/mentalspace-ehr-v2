{
  "family": "migration-entrypoint-override",
  "cpu": "256",
  "memory": "512",
  "networkMode": "awsvpc",
  "requiresCompatibilities": ["FARGATE"],
  "executionRoleArn": "arn:aws:iam::706704660887:role/ecsTaskExecutionRole",
  "taskRoleArn": "arn:aws:iam::706704660887:role/ecsTaskExecutionRole",
  "containerDefinitions": [{
    "name": "migration",
    "image": "706704660887.dkr.ecr.us-east-1.amazonaws.com/mentalspace-backend:c3a7950",
    "essential": true,
    "entryPoint": ["node"],
    "command": [
      "-e",
      "const {Client} = require('pg'); const c = new Client({connectionString: process.env.DATABASE_URL, ssl: {rejectUnauthorized: false}}); (async () => {await c.connect(); console.log('Connected'); await c.query('ALTER TABLE \"clinical_notes\" ALTER COLUMN \"appointmentId\" DROP NOT NULL'); console.log('OK appointmentId'); await c.query('ALTER TABLE \"clinical_notes\" ALTER COLUMN \"sessionDate\" DROP NOT NULL'); console.log('OK sessionDate'); await c.query('ALTER TABLE \"clinical_notes\" ALTER COLUMN \"dueDate\" DROP NOT NULL'); console.log('OK dueDate'); await c.query(`INSERT INTO \"_prisma_migrations\" (id, checksum, finished_at, migration_name, logs, rolled_back_at, started_at, applied_steps_count) VALUES ($1, $2, NOW(), $3, $4, NULL, NOW(), 1) ON CONFLICT (migration_name) DO NOTHING`, ['20251119024521_make_draft_fields_nullable', '3f8c5a9e2b1d7c4f6e8a0b2c4d6e8f0a', '20251119024521_make_draft_fields_nullable', 'Migration applied via ECS task']); console.log('OK migration tracked'); const r = await c.query(`SELECT column_name, is_nullable FROM information_schema.columns WHERE table_name = 'clinical_notes' AND column_name IN ('appointmentId', 'sessionDate', 'dueDate')`); console.log('Verification:', JSON.stringify(r.rows)); await c.end(); console.log('COMPLETE')})().catch(e => {console.error('ERROR:', e); process.exit(1)})"
    ],
    "environment": [{
      "name": "DATABASE_URL",
      "value": "postgresql://mentalspace_admin:MentalSpace2024!SecurePwd@mentalspace-ehr-prod.ci16iwey2cac.us-east-1.rds.amazonaws.com:5432/mentalspace_ehr"
    }],
    "logConfiguration": {
      "logDriver": "awslogs",
      "options": {
        "awslogs-group": "/ecs/mentalspace-migration",
        "awslogs-region": "us-east-1",
        "awslogs-stream-prefix": "entrypoint-override",
        "awslogs-create-group": "true"
      }
    }
  }]
}
